version: '2.4'
services:
  traefik:
    image: traefik:v2.10
    cpu_shares: 256
    mem_limit: 256m
    container_name: traefik
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--providers.file.directory=/etc/traefik/dynamic_conf"
      - "--providers.file.watch=true"
    ports:
      - "80:80"
      - "443:443"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik_dynamic_conf:/etc/traefik/dynamic_conf
    restart: unless-stopped
    network_mode: bridge

  plex:
    image: plexinc/pms-docker
    cpu_shares: 3072
    mem_limit: 3072m
    container_name: plex
    restart: unless-stopped
    environment:
      - TZ=America/Chicago
      - PLEX_CLAIM=${PLEX_CLAIM}
    network_mode: host
    volumes:
      - /var/lib/plexmediaserver:/config
      - /tmp:/transcode
      - /mnt/vault1:/mnt/vault1
      - /mnt/vault2:/mnt/vault2

  jellyfin:
    image: jellyfin/jellyfin
    cpu_shares: 1024
    mem_limit: 1024m
    container_name: jellyfin
    restart: unless-stopped
    environment:
      - TZ=America/Chicago
    ports:
      - 8096:8096
    network_mode: bridge
    volumes:
      - /var/lib/jellyfin/config:/config
      - /var/lib/jellyfin/cache:/cache
      - /mnt/vault1:/mnt/vault1
      - /mnt/vault2:/mnt/vault2
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyfin.rule=Host(`watch.${DOMAIN}`)"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    cpu_shares: 768
    mem_limit: 768m
    container_name: jellyseerr
    environment:
      - LOG_LEVEL=debug
      - TZ=America/Chicago
      - PORT=5055
    ports:
      - 5055:5055
    volumes:
      - /var/lib/jellyseerr/config:/app/config
    restart: unless-stopped
    network_mode: bridge
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyseerr.rule=Host(`find.${DOMAIN}`)"
      - "traefik.http.services.jellyseerr.loadbalancer.server.port=5055"

  transmission-vpn:
    image: haugene/transmission-openvpn:latest
    cpu_shares: 1024
    mem_limit: 1024m
    container_name: transmission-vpn
    env_file: .env
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    restart: unless-stopped
    ports:
      - "9091:9091"
      - "51413:51413"
      - "51413:51413/udp"
    environment:
      - OPENVPN_PROVIDER=${OPENVPN_PROVIDER}
      - OPENVPN_USERNAME=${OPENVPN_USERNAME}
      - OPENVPN_PASSWORD=${OPENVPN_PASSWORD}
      - OPENVPN_CONFIG=${OPENVPN_CONFIG}
      - LOCAL_NETWORK=192.168.0.0/16,172.16.0.0/12
      - TRANSMISSION_RPC_USERNAME=${TRANSMISSION_RPC_USERNAME}
      - TRANSMISSION_RPC_PASSWORD=${TRANSMISSION_RPC_PASSWORD}
      - TRANSMISSION_DOWNLOAD_DIR=/mnt/vault2/Downloaded
      - TRANSMISSION_INCOMPLETE_DIR=/incomplete
      - TRANSMISSION_WATCH_DIR=/watch
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - /var/lib/transmission-daemon/.config/transmission-daemon:/config
      - /mnt/vault2/Downloaded:/mnt/vault2/Downloaded
      - /mnt/vault2/Incomplete:/incomplete
      - /var/lib/transmission-daemon/downloads:/watch
    network_mode: bridge

  radarr:
    container_name: radarr
    image: ghcr.io/hotio/radarr
    cpu_shares: 256
    mem_limit: 256m
    ports:
      - "7878:7878"
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - /var/lib/radarr/config:/config
      - /mnt/vault1:/mnt/vault1
      - /mnt/vault2:/mnt/vault2
    restart: unless-stopped
    network_mode: bridge
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.radarr.rule=Host(`movies.${DOMAIN}`)"
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"

  prowlarr:
    container_name: prowlarr
    image: ghcr.io/hotio/prowlarr
    cpu_shares: 256
    mem_limit: 256m
    ports:
      - "9696:9696"
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - /var/lib/prowlarr/config:/config
    restart: unless-stopped
    network_mode: host

  sonarr:
    container_name: sonarr
    image: ghcr.io/hotio/sonarr
    cpu_shares: 256
    mem_limit: 256m
    ports:
      - "8989:8989"
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - /var/lib/sonarr/config:/config
      - /mnt/vault1:/mnt/vault1
      - /mnt/vault2:/mnt/vault2
    restart: unless-stopped
    network_mode: bridge
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sonarr.rule=Host(`shows.${DOMAIN}`)"
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"

  bazarr:
    container_name: bazarr
    image: ghcr.io/linuxserver/bazarr
    cpu_shares: 256
    mem_limit: 256m
    ports:
      - 6767:6767
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - /var/lib/bazarr/config:/config
      - /mnt/vault1:/mnt/vault1
      - /mnt/vault2:/mnt/vault2
    restart: unless-stopped
    network_mode: host